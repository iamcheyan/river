#!/bin/sh

# 这是 river 窗口管理器的配置文件
#
# 如需编辑此文件，建议先将其复制到
# $XDG_CONFIG_HOME/river/init 或 $HOME/.config/river/init
#
# 完整文档请参阅 river(1)、riverctl(1) 和 rivertile(1) 手册页

# 注意："Super" 修饰键也称为 Logo、GUI、Windows、Mod4 等

# ============================================================================
# 环境变量设置
# ============================================================================
# 区域设置（日语环境）
export LANG=ja_JP.UTF-8
export LC_ALL=ja_JP.UTF-8

# Wayland 会话信息
export XDG_CURRENT_DESKTOP=river
export XDG_SESSION_TYPE=wayland

# 光标主题和大小设置
export XCURSOR_THEME=Adwaita    # 使用的光标主题
export XCURSOR_SIZE=24          # 光标大小（像素）

# 主修饰键（Super = Windows/Meta 键）
MOD=Super

# ============================================================================
# 键盘设置（JIS 配列）
# ============================================================================
riverctl keyboard-layout jp      # 设置日语键盘布局
riverctl keyboard-model jp106    # 指定 106/109 键盘型号
riverctl keyboard-options ctrl:nocaps  # 将 Caps Lock 作为 Ctrl 键使用


# ----- 基本操作 -----
# Super + Enter: 启动终端（foot）
riverctl map normal $MOD Return spawn foot

# 运行启动器（rofi）
riverctl map normal $MOD Shift Return spawn "rofi -show drun"

# 文件管理器
riverctl map normal $MOD e spawn "pcmanfm"

# 浏览器
riverctl map normal $MOD b spawn "qutebrowser"

# 注销菜单
riverctl map normal $MOD x spawn "/home/tetsuya/.config/bin/power"

# 更换壁纸
riverctl map normal $MOD w spawn "/home/tetsuya/.config/bin/wall.sh"

# 使用 grim 截图
riverctl map normal $MOD s spawn "grim"

# Super+Q 关闭当前焦点窗口
riverctl map normal $MOD Q close

# Super+Shift+Q 退出 river
riverctl map normal $MOD Shift Q exit

# Super+J 和 Super+K 在布局堆栈中聚焦下一个/上一个窗口
riverctl map normal $MOD J focus-view next
riverctl map normal $MOD K focus-view previous

# Super+Shift+J 和 Super+Shift+K 在布局堆栈中交换当前焦点窗口与下一个/上一个窗口
riverctl map normal $MOD Shift J swap next
riverctl map normal $MOD Shift K swap previous

# Super+Period 和 Super+Comma 聚焦下一个/上一个输出
riverctl map normal $MOD Period focus-output next
riverctl map normal $MOD Comma focus-output previous

# Super+Shift+{Period,Comma} 将当前焦点窗口发送到下一个/上一个输出
riverctl map normal $MOD Shift Period send-to-output next
riverctl map normal $MOD Shift Comma send-to-output previous

# Super+Return 将当前焦点窗口提升到布局堆栈顶部
#riverctl map normal $MOD Return zoom

# Super+H 和 Super+L 减少/增加 rivertile(1) 的主窗口比例
riverctl map normal $MOD H send-layout-cmd rivertile "main-ratio -0.05"
riverctl map normal $MOD L send-layout-cmd rivertile "main-ratio +0.05"

# Super+Shift+H 和 Super+Shift+L 增加/减少 rivertile(1) 的主窗口数量
riverctl map normal $MOD Shift H send-layout-cmd rivertile "main-count +1"
riverctl map normal $MOD Shift L send-layout-cmd rivertile "main-count -1"

# Super+Alt+{H,J,K,L} 移动窗口
riverctl map normal $MOD Alt H move left 100
riverctl map normal $MOD Alt J move down 100
riverctl map normal $MOD Alt K move up 100
riverctl map normal $MOD Alt L move right 100

# Super+Alt+Control+{H,J,K,L} 将窗口吸附到屏幕边缘
riverctl map normal $MOD Alt Control H snap left
riverctl map normal $MOD Alt Control J snap down
riverctl map normal $MOD Alt Control K snap up
riverctl map normal $MOD Alt Control L snap right

# Super+Alt+Shift+{H,J,K,L} 调整窗口大小
riverctl map normal $MOD Alt Shift H resize horizontal -100
riverctl map normal $MOD Alt Shift J resize vertical 100
riverctl map normal $MOD Alt Shift K resize vertical -100
riverctl map normal $MOD Alt Shift L resize horizontal 100

# Super + 鼠标左键 移动窗口
riverctl map-pointer normal $MOD BTN_LEFT move-view

# Super + 鼠标右键 调整窗口大小
riverctl map-pointer normal $MOD BTN_RIGHT resize-view

# Super + 鼠标中键 切换浮动模式
riverctl map-pointer normal $MOD BTN_MIDDLE toggle-float

for i in $(seq 1 9)
do
    tags=$((1 << ($i - 1)))

    # Super+[1-9] 聚焦标签 [0-8]
    riverctl map normal $MOD $i set-focused-tags $tags

    # Super+Shift+[1-9] 将当前焦点窗口标记为标签 [0-8]
    riverctl map normal $MOD Shift $i set-view-tags $tags

    # Super+Control+[1-9] 切换标签 [0-8] 的聚焦状态
    riverctl map normal $MOD Control $i toggle-focused-tags $tags

    # Super+Shift+Control+[1-9] 切换当前焦点窗口的标签 [0-8]
    riverctl map normal $MOD Shift Control $i toggle-view-tags $tags
done

# Super+0 聚焦所有标签
# Super+Shift+0 将当前焦点窗口标记为所有标签
all_tags=$(((1 << 32) - 1))
riverctl map normal $MOD 0 set-focused-tags $all_tags
riverctl map normal $MOD Shift 0 set-view-tags $all_tags

# Super+Space 切换浮动模式
riverctl map normal $MOD Space toggle-float

# Super+F 切换全屏模式
riverctl map normal $MOD F toggle-fullscreen

# Super+{Up,Right,Down,Left} 更改布局方向
riverctl map normal $MOD Up    send-layout-cmd rivertile "main-location top"
riverctl map normal $MOD Right send-layout-cmd rivertile "main-location right"
riverctl map normal $MOD Down  send-layout-cmd rivertile "main-location bottom"
riverctl map normal $MOD Left  send-layout-cmd rivertile "main-location left"

# 声明一个直通模式。此模式只有一个映射用于返回到
# 正常模式。这对于测试嵌套的 wayland 合成器很有用
riverctl declare-mode passthrough

# Super+F11 进入直通模式
riverctl map normal $MOD F11 enter-mode passthrough

# Super+F11 返回到正常模式
riverctl map passthrough $MOD F11 enter-mode normal

# 各种媒体键映射示例，适用于正常模式和锁定模式
# 这些键不需要修饰键
for mode in normal locked
do
    # 弹出光驱（如果你还有的话）
    riverctl map $mode None XF86Eject spawn 'eject -T'

    # 使用 pamixer 控制 Pulse 音频音量 (https://github.com/cdemoulins/pamixer)
    riverctl map $mode None XF86AudioRaiseVolume  spawn 'pamixer -i 5'
    riverctl map $mode None XF86AudioLowerVolume  spawn 'pamixer -d 5'
    riverctl map $mode None XF86AudioMute         spawn 'pamixer --toggle-mute'

    # 使用 playerctl 控制支持 MPRIS 的媒体播放器 (https://github.com/altdesktop/playerctl)
    riverctl map $mode None XF86AudioMedia spawn 'playerctl play-pause'
    riverctl map $mode None XF86AudioPlay  spawn 'playerctl play-pause'
    riverctl map $mode None XF86AudioPrev  spawn 'playerctl previous'
    riverctl map $mode None XF86AudioNext  spawn 'playerctl next'

    # 使用 light 控制屏幕背光亮度 (https://github.com/haikarainen/light)
    riverctl map $mode None XF86MonBrightnessUp   spawn 'light -A 5'
    riverctl map $mode None XF86MonBrightnessDown spawn 'light -U 5'
done

# 设置背景和边框颜色
riverctl background-color 0x002b36
riverctl border-color-focused 0x93a1a1
riverctl border-color-unfocused 0x586e75

# 设置键盘重复速率
riverctl set-repeat 50 300

# 使所有 app-id 以 "float" 开头且标题为 "foo" 的窗口自动浮动
riverctl rule-add -app-id 'float*' -title 'foo' float

# 使所有 app-id 为 "bar" 且任意标题的窗口使用客户端装饰
riverctl rule-add -app-id "bar" csd

# 设置默认布局生成器为 rivertile 并启动它
# River 将在退出时向 init 可执行文件的进程组发送 SIGTERM
riverctl default-layout rivertile
rivertile -view-padding 4 -outer-padding 4 &
# 自动启动
/home/tetsuya/.config/river/autostart.sh

